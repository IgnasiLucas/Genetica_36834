---
title: "T06. Genética de poblaciones"
output: ioslides_presentation
date: "`r Sys.Date()`"
bibliography: ../references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## La pregunta de Yule 

<div style="float: left; width: 50%;">

```{r mendel, echo=FALSE}
par(mfrow = c(1,2), mar = c(0,0,4,0))
plot(c(0,1), c(0, 1), type='n', axes = FALSE, xlab = '', ylab = '',
     main = 'Mendel:', cex.main = 2)
text(c(0.3, 0.5, 0.7), 0.95, labels = c('Aa', 'x', 'Aa'), cex = 2)
arrows(0.5, 0.8, 0.5, 0.5)
text(c(0.1, 0.3, 0.5, 0.7, 0.9), 0.3,
     labels = c('1 AA', ':', '2 Aa', ':', '1 aa'), cex = 2)
text(c(0.3, 0.7, 0.9), 0.1,
     labels = c('3 Dominantes', ':', '1\nRecesivo'), cex = 1.2)
par(mfrow = c(1,1))
```

</div>

<div style="float: right; width: 50%;">

> "Pero, si la braquidactilia estuviera determinada per un alelo dominante y si
> el apareamiento fuera aleatorio, esperaríamos tres personas con braquidactilia
> por cada persona normal, ¿no?"
>
> `r tufte::quote_footer('--- G. Udny Yule (1908)')`

</div>

## Desafíos intelectuales en 1908

- ¿Cómo cambian las frecuencias *genotípicas* con el tiempo?
   - De cruces controlados a reproducción aleatoria.
- ¿Qué importancia tiene la *dominancia* en ese cambio?
   - Ninguna!
- ¿Cómo explicar los caracteres cuantitativos?
   - (Tema 5)

## ¿Cambian las frecuencias genotípicas?

- $P$: Frecuencia del genotipo **AA**.
- $H$: Frecuencia del genotipo **Aa**.
- $Q$: Frecuencia del genotipo **aa**.

Con reproducción aleatoria los cigotos se forman con las probabilidades:

```{r arbre, echo=FALSE, fig.height = 3}
par(mar=c(0,0,0,0))
plot(c(0,12), c(0, 8), type = 'n', axes = FALSE, xlab = '', ylab = '')
arrows(c(1,1,4,4,4,4), c(4,4,2,2,6,6), c(2.7,2.7,6,6,6,6), c(2.5,5.5,1,3,5,7),
       length = 0.1, code = 2)
text(c(3,3,7,7,7,7,10,10,10,10),
     c(2,6,1,3,5,7,1,3,5,7),
     labels = c('a','A','a','A','a','A', expression((Q+frac(H,2))^2*'   aa'),
                expression((Q+frac(H,2))(P+frac(H,2))*'   aA'),
                expression((P+frac(H,2))(Q+frac(H,2))*'   Aa'),
                expression((P+frac(H,2))^2*'   AA')))
text(c(1,1,5,5,5,5), c(3,5,1,3,5,7),
     labels = c(expression(Q+frac(H,2)), expression(P+frac(H,2)),
                expression(Q+frac(H,2)), expression(P+frac(H,2)),
                expression(Q+frac(H,2)), expression(P+frac(H,2))),
     cex = 0.8)
```

## ¿Cambian las frecuencias genotípicas? {.smaller}

Con reproducción aleatoria, las frecuencias de los gametos **A** y **a**
son $P+\frac{H}{2}$ y $Q+\frac{H}{2}$, respectivamente. Tambien podemos verlo así:

```{r punnet, fig.width=5.5, fig.height=5}
par(mar=c(0,2,2,0))
plot(c(0, 10), c(0, 9), axes = FALSE, xlab = '', ylab = '', type = 'n')
segments(c(0,0,0,0,2,6), c(3,7,9,3,3,3),
         c(6,6,6,0,2,6), c(3,7,9,9,9,9))
axis(2, at = c(5, 8), labels = c('a', 'A'), tick = FALSE, las = 2)
axis(3, at = c(1, 4), labels = c('A', 'a'), tick = FALSE)
d <- 0.025
arrows(c(0,2+d,7,7), c(2,2,3,7+d), c(2-d,6,7,7), c(2,2,7-d,9),
       code = 3, length=0.1)
text(c(1,4,8,8), c(1,1,5,8),
     labels = c(expression(P+frac(H,2)), 
                expression(Q+frac(H,2)),
                expression(Q+frac(H,2)),
                expression(P+frac(H,2))))
text(c(1,1,4,4), c(6,8.5,6,8.5),
     labels = c('aA', 'AA', 'aa', 'Aa'))
text(c(1,1,4,4), c(5,7.5,5,7.5),
     labels = c(expression((Q+frac(H,2))(P+frac(H,2))),
                expression((P+frac(H,2))^2),
                expression((Q+frac(H,2))^2),
                expression((P+frac(H,2))(Q+frac(H,2)))))
```

## ¿Cambian las frecuencias genotípicas? {.smaller}

```{r cruces}
library(kableExtra)
creuaments <- data.frame(
   pare = c('AA', 'AA', 'AA', 'Aa', 'Aa', 'Aa', 'aa', 'aa', 'aa', 'Total:'),
   mare = c('AA', 'Aa', 'aa', 'AA', 'Aa', 'aa', 'AA', 'Aa', 'aa', ''),
   freq = c("$P^2$", "$PH$", "$PQ$",
            "$PH$", "$H^2$", "$QH$",
            "$PQ$", "$QH$", "$Q^2$", "$(P+H+Q)^2=1$"),
   AA = c("$1$", "$\\frac{1}{2}$", "$0$", "$\\frac{1}{2}$", "$\\frac{1}{4}$", "$0$", "$0$", "$0$", "$0$", "$P'$"),
   Aa = c("$0$", "$\\frac{1}{2}$", "$1$", "$\\frac{1}{2}$", "$\\frac{1}{2}$", "$\\frac{1}{2}$", "$1$", "$\\frac{1}{2}$", "$0$", "$H'$"),
   aa = c("$0$", "$0$", "$0$", "$0$", "$\\frac{1}{4}$", "$\\frac{1}{2}$", "$0$", "$\\frac{1}{2}$", "$1$", "$Q'$")
)
kable(creuaments, col.names = c('Padre', 'Madre', 'Frecuencia', 'AA', 'Aa', 'aa')) %>% kable_styling()
```

$P' = \left(P + \frac{H}{2}\right)^2, \qquad 
H' = 2\left(P + \frac{H}{2}\right)\left(Q + \frac{H}{2}\right), \qquad
Q' = \left(Q + \frac{H}{2}\right)^2$

## ¿Cambian las frecuencias genotípicas?

Las frecuencias genotípicas después de una generación de reproducción
aleatoria serían:

$$P' = \left(P + \frac{H}{2}\right)^2$$

$$H' = 2\cdot \left(P + \frac{H}{2}\right) \cdot \left( Q+\frac{H}{2} \right)$$

$$Q' = \left(Q + \frac{H}{2}\right)^2$$

@Hardy1908 demostró (ver Apéndice) que las frecuencias genotípicas se mantienen
constantes si $H^2 = 4PQ$, lo cual es siempre cierto a partir de la segunda
generación.

## Equilibrio de Hardy-Weinberg

Las frecuencias genotípicas se mantienen constantes siempre que en una
población diploide:

1. La reproducción sea sexual y aleatoria (i.e., no hay consanguinidad).
2. El genotipo no afecta la probabilidad de sobrevivir o reproducirse (i.e., no
hay selección natural).
3. La población es suficientemente grande (i.e., no hay deriva genética).
4. No hay inmigración.

## Frecuencias alélicas

Hubiera sido más fácil definir estas dos variables:

$$p = P + \frac{H}{2}$$

$$q = Q + \frac{H}{2}$$

Las frecuencias de los alelos **A** y **a**, respectivamente. Ahora, podemos
expresar las frecuencias genotípicas después de la reproducción así:

$$P' = p^2, \qquad H' = 2pq, \qquad Q' = q^2$$

## Ejemplo {.smaller}

<div style="float: left; width: 50%;">
```{r MN}
MN <- data.frame(
   Fenotipo = c('MM', 'MN', 'NN', 'Total:'),
   Genotipo = c("$L^ML^M$", "$L^ML^N$", "$L^NL^N$", ""),
   Frecuencia = c(141, 262, 97, 500)
)
kable(MN) %>% kable_styling()
```

</div>

<div style="float: right; width: 50%;">
$$p = \frac{2\times 141 + 262}{2\times 500} = 0.544$$
$$q = \frac{2\times 97 + 262}{2\times 500} = 0.456$$
</div>

## Algunas conclusiones

1. La **dominancia** en sí no tiene ningúna importancia en los posibles cambios de una
población a lo largo del tiempo.
2. Si la reproducción es aleatoria, las frecuencias genotípicas están determinadas
por las **frecuencias alélicas**:
   - Frecuencia de homocigotos de un tipo: $P = p^2$
   - Frecuencia de heterocigotos: $H = 2\cdot p\cdot q$
   - Frecuencia de homocigotos del otro tipo: $Q = q^2$
3. Lo fundamental de la **evolución** son los cambios en las frecuencias alélicas.

## Con tres alelos {.smaller}

<div style="float: left; width: 50%;">

```{r}
library(kableExtra)
T <- data.frame(Fenotipo = c('A','AB','A','B','B','O'),
                Genotipo = c('$I^AI^A$', '$I^AI^B$', '$I^AI^0$',
                             '$I^BI^B$', '$I^BI^0$', '$I^0I^0$'),
                Frecuencia = c('$p^2$', '$2pq$', '$2pr$', '$q^2$', '$2qr$', '$r^2$'))
kable(T) %>% kable_styling(full_width = FALSE)
```

</div>

<div style="float: right; width: 50%;">

```{r}
T <- data.frame(Alelo = c('$I^A$', '$I^B$', '$I^0$'),
                Frecuencia = c('p', 'q', 'r'))
kable(T) %>% kable_styling(full_width = FALSE)
```

$$
p + q + r = 1\\
(p+q+r)^2 = 1\\
p^2 + 2pq + 2pr + q^2 + 2qr + r^2 = 1
$$
</div>

## En el cromosoma X

$$
p = \text{Frecuencia del alelo } X^1\\
q = \text{Frecuencia del alelo } X^2
$$

```{r}
T <- data.frame(Genotipo = c('$X^1X^1$', '$X^1X^2$', '$X^2X^2$', '$X^1Y$','$X^2Y$'),
                Sexo = c('hembra', 'hembra', 'hembra', 'macho', 'macho'),
                Frecuencia = c('$p^2$', '$2pq$', '$q^2$', '$p$', '$q$'))
kable(T) %>% kable_styling()
```

Las frecuencias genotípicas se expresan en cada sexo por separado.

## Cómo comprobar el equilibrio
Una muestra de individuos mostró los grupos sanguíneos siguientes: 114 MM, 76 MN
y 10 NN (total: 200). ¿Está en equilibrio de Hardy-Weinberg esta población?

```{r}
T <- data.frame(Genotipo = c('MM', 'MN', 'NN', ''),
                Observados = c(114, 76, 10, 114+76+10),
                Esperados = c('', '', '', ''),
                Dif = c('', '', '', ''))
kable(T, col.names = c('Genotipo', 'Observados', 'Esperados', '$(O-E)^2/E$'),
      align = c('l', 'r', 'r', 'r')) %>%
  kable_styling(full_width = TRUE)
```

Partimos de 3 datos: 3 grados de libertad, en principio. Pero...

## Cómo comprobar el equilibrio

```{r}
T$Esperados <- c('$N\\times p^2$', '$N\\times 2pq$', '$N\\times q^2$', '$N$')
kable(T, col.names = c('Genotipo', 'Observados', 'Esperados', '$(O-E)^2/E$'),
      align = c('l', 'r', 'c', 'r')) %>%
  kable_styling(full_width = TRUE)
```

¿Cuántos parámetros necesitamos *fijar* para calcular los números *esperados*?

## Cómo comprobar el equilibrio

```{r}
T$Esperados <- c('$N\\times p^2$', '$N\\times 2pq$', '$N\\times q^2$', '$N$')
kable(T, col.names = c('Genotipo', 'Observados', 'Esperados', '$(O-E)^2/E$'),
      align = c('l', 'r', 'c', 'r')) %>%
  kable_styling(full_width = TRUE)
```

¿Cuántos parámetros necesitamos *fijar* para calcular los números *esperados*?
Sólo dos: $N$ y $p$ (o bien, $N$ y $q$), porque $p+q=1$. Por tanto, queda sólo
$3 - 2 = 1$ grado de libertad.

## Cómo comprobar el equilibrio

```{r}
N <- sum(T[1:3, 'Observados'])
p <- (2 * 114 + 76) / (2 * 200)
q <- (76 + 2 * 10) / (2 * 200)
T$Esperados <- N * c(p ^ 2, 2 * p * q, q ^ 2, 1)
T$Dif <- (T$Observados - T$Esperados) ^ 2 / T$Esperados
T[4, 'Dif'] <- sum(T[1:3, 'Dif'])
kable(T, col.names = c('Genotipo', 'Observados', 'Esperados', '$(O-E)^2/E$'),
      align = c('l', 'r', 'r', 'r'), digits = 2) %>%
  kable_styling(full_width = TRUE)
```

$$
p = \frac{2\times 114 + 76}{2\times 200} = 0.76\\
q = \frac{76 + 2\times 10}{2\times 200} = 0.24 = 1 - p\\
$$

## Cómo comprobar el equilibrio

```{r}
X <- 0.35
x <- seq(from = 0.01, to = 2.5, by = 0.01)
y <- dchisq(x, 1)
plot(x, y, type = 'l', xlab = 'X', ylab = 'Densidad de probabilidad',
     main = expression("Distribución "*chi[1]^2), lwd = 3, cex.main = 2,
     xlim = c(0, 2))
polygon(c(x[x >= X], max(x), X), c(y[x >= X], 0, 0), col = 'pink')
text(0.5, 3, expression(P(X>=0.35)*"="*0.5541131), pos = 4, cex = 1.5)
axis(1, at = 0.35)
```

Conclusión: la población parece estar en equilibrio de Hardy-Weinberg.

## Resumen

- **Teoría**: equilibrio de Hardy-Weinberg (*HWE*):
$$
P=p^2\\
H=2pq\\
Q=q^2
$$

- **Datos**: Por ejemplo:
$$
N\cdot P=114\\
N\cdot H = 76\\
N\cdot Q=10
$$

- **Test**: ¿Se corresponden los datos con la esperanza teórica?

## Otra aplicación de la teoría

- **Teoría**: Equilibrio de Hardy-Weinberg: $Q = q^2$, etc.
- **Datos parciales**: Por ejemplo, con dominancia:
$$
N\cdot (P + H) = 190\\
N\cdot Q = 10
$$

- **Estimación**: si $10 \simeq 200 \times q^2$, entonces
$$
\hat{q} = \sqrt\frac{10}{200}
$$

## Apéndice

Asumiendo reproducción aleatoria, habíamos deducido que las frecuencias
genotípicas podían expresarse en función de las de la generación anterior así:

$P' = \left(P + \frac{H}{2}\right)^2$

$H' = 2\cdot \left(P + \frac{H}{2}\right) \cdot \left( Q+\frac{H}{2} \right)$

$Q' = \left(Q + \frac{H}{2}\right)^2$

Siguiendo el razonamiento de @Hardy1908, nos preguntamos bajo qué condiciones
las frecuencias genotípicas no cambiarían, de manera que $P'=P$, $H'=H$ y 
$Q'=Q$.

## Apéndice {.smaller}
La constancia de las frecuencias genotípicas implicaría lo siguiente:

$H = 2\cdot \left(P + \frac{H}{2}\right) \cdot \left( Q+\frac{H}{2} \right)$

$H = 2 \left( PQ + \frac{PH}{2} + \frac{QH}{2} + \frac{H^2}{4}\right)$

$H = 2PQ + PH + QH + \frac{H^2}{2}$

$H = H(P+Q)+2PQ + \frac{H^2}{2}$

$H-H(P+Q)-2PQ = \frac{H^2}{2}$

$H(1-P-Q) - 2PQ = \frac{H^2}{2}$

$H^2 - 2PQ = \frac{H^2}{2} \qquad$   (Porque $P+H+Q=1$)

$H^2-\frac{H^2}{2} = 2PQ \qquad \rightarrow \qquad H^2 = 4PQ$

## Apéndice
La condición $H^2=4PQ$ no tiene por qué darse en la primera generación, pero se
demuestra que en la segunda sí se da, $H'^2 = 4P'Q'$, sea qual sea el valor de
$P$, $H$ y $Q$ en la primera generación:

$H'^2 = \left(2\left( P+\frac{H}{2}\right)\left( Q+\frac{H}{2}\right)\right)^2$

$H'^2 = 4\left(P+\frac{H}{2}\right)^2\left( Q+\frac{H}{2}\right)^2$

$H'^2 = 4P'^2Q'^2$

Conclusión: no hay ningún motivo para pensar que la segregación de los alelos
ni la dominancia hagan cambiar las frecuencias genotípicas, siempre que la
reproducción sea aleatoria.

## References